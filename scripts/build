#!/bin/bash

set -eu -o pipefail

# Extract artifact ID and version from pom.xml
ARTIFACT_ID=$(mvn org.apache.maven.plugins:maven-help-plugin:3.2.0:evaluate \
-Dexpression=project.artifactId -q -DforceStdout)

VERSION=$(mvn org.apache.maven.plugins:maven-help-plugin:3.2.0:evaluate \
-Dexpression=project.version -q -DforceStdout)

# Set Jar Name
JAR_NAME="target/$ARTIFACT_ID-$VERSION.jar"

# Announce
echo "Packaging $JAR_NAME..."

# Clean and package via maven, creating the jar file that will match JAR_NAME
mvn clean package

# Post process cleanup (Required due to the CXF codegen plugin hard coding paths)
# scripts/post-process $JAR_NAME

# Announce and calculate checksum
echo "Packaging complete, saving as artifact."
echo "Calculating checksum."
sha512sum $JAR_NAME > checksums.txt
ls